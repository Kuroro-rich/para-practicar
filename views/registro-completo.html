<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Completo</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="/css/estilos.css">
    <style>
        .tab-content {
            display: none;
        }

        .tab-content.is-active {
            display: block;
        }

        .header-section {
            background-color: #333;
            color: white;
            padding: 8px;
            text-align: center;
            margin-bottom: 10px;
        }

        .yellow-bg {
            background-color: #ffffcc;
        }

        .field-label {
            font-weight: bold;
        }

        .required::before {
            content: "(*)";
            color: red;
            margin-right: 5px;
        }

        .documents-section {
            background-color: #eee;
        }

        /* Estilos para el modal de búsqueda */
        .modal-card {
            max-width: 800px;
            width: 80%;
        }

        .establecimiento-resultados {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>

<body>
    <section class="section">
        <div class="container">
            <h1 class="title has-text-centered">Registro Completo</h1>

            <!-- Pestañas -->
            <div class="tabs is-centered is-boxed">
                <ul>
                    <li class="is-active" data-tab="datos-personales"><a>Datos Personales</a></li>
                    <li data-tab="datos-familiares"><a>Datos Familiares</a></li>
                    <li data-tab="datos-apoderado"><a>Datos Apoderado</a></li>
                </ul>
            </div>

            <!-- Contenido de las pestañas -->
            <!-- Datos Personales -->
            <div id="datos-personales" class="tab-content is-active">
                <div class="header-section">Datos Personales</div>
                <form id="form-datos-personales">
                    <div class="columns is-multiline">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Apellido Paterno</label>
                                <div class="control">
                                    <input class="input" type="text" name="apellidoPaterno" placeholder="Apellido Paterno" required>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Apellido Materno</label>
                                <div class="control">
                                    <input class="input" type="text" name="apellidoMaterno"
                                        placeholder="Apellido Materno" required>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Nombres</label>
                                <div class="control">
                                    <input class="input" type="text" name="nombres" placeholder="Nombres" required>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Cédula de identidad</label>
                                <div class="control is-flex">
                                    <input class="input" type="text" name="rut" placeholder="Ej: 12.345.678-9" required>
                                    <label class="checkbox ml-2">
                                        <input type="checkbox" name="sinRut">
                                        Sin Rut
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Nacionalidad</label>
                                <div class="control">
                                    <div class="select is-fullwidth">
                                        <select name="idNacionalidad">
                                            <option value="">** Cargando nacionalidades... **</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Origen indígena (No preguntar)</label>
                                <div class="control">
                                    <label class="radio">
                                        <input type="radio" name="origenIndigena" value="Si">
                                        Sí
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="origenIndigena" value="No" checked>
                                        No
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Fecha De Nacimiento</label>
                                <div class="control">
                                    <input class="input" type="date" name="fechaNacimiento" required>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Género</label>
                                <div class="control">
                                    <label class="radio">
                                        <input type="radio" name="genero" value="1">
                                        Masculino
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="genero" value="2" checked>
                                        Femenino
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Calle/Pasje/Av.</label>
                                <div class="control">
                                    <input class="input" type="text" name="direccion"
                                        placeholder="Calle/Pasaje/Avenida">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Nro</label>
                                <div class="control">
                                    <input class="input" type="text" name="numero" placeholder="Número">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Villa o población</label>
                                <div class="control">
                                    <input class="input" type="text" name="villa" placeholder="Villa o Población">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Departamento</label>
                                <div class="control">
                                    <input class="input" type="text" name="departamento" placeholder="Departamento">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Número de Teléfono</label>
                                <div class="control">
                                    <input class="input" type="text" name="telefono" placeholder="Teléfono">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Comuna</label>
                                <div class="control">
                                    <div class="select is-fullwidth">
                                        <select name="idComuna">
                                            <option value="">** Cargando comunas... **</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Nombre del Contacto</label>
                                <div class="control">
                                    <input class="input" type="text" name="nombreContacto"
                                        placeholder="Nombre del Contacto">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">E-Mail</label>
                                <div class="control">
                                    <input class="input" type="email" name="email" placeholder="Correo Electrónico">
                                </div>
                            </div>
                        </div>
                        <div class="column is-3">
                            <div class="field">
                                <label class="label">Año de Ingreso</label>
                                <div class="control">
                                    <div class="select is-fullwidth">
                                        <select name="anioIngreso" id="anioIngreso">
                                            <option value="">Cargando años académicos...</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Establecimiento Anterior -->
                    <div class="field">
                        <label class="label required">Establecimiento Anterior</label>
                        <div class="control">
                            <div class="select is-fullwidth">
                                <select name="idEstablecimientoAnterior" id="idEstablecimientoAnterior">
                                    <option value="">** Cargando establecimientos... **</option>
                                </select>
                            </div>
                        </div>
                        <label class="checkbox ml-2">
                            <input type="checkbox" name="sinInformacion" id="checkSinInformacion">
                            Sin información
                        </label>
                    </div>

                    <div class="field">
                        <label class="label required">Promedio Anterior</label>
                        <div class="control">
                            <input class="input" type="text" name="promedioAnterior" placeholder="Promedio Anterior">
                        </div>
                    </div>

                    <div class="field">
                        <label class="label required">¿Ha estado en programa PIE?</label>
                        <div class="control">
                            <label class="radio">
                                <input type="radio" name="programaPIE" value="Si">
                                Sí
                            </label>
                            <label class="radio">
                                <input type="radio" name="programaPIE" value="No" checked>
                                No
                            </label>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label">Plan al que postula</label>
                        <div class="control">
                            <div class="select is-fullwidth">
                                <select name="plan">
                                    <option value="">** Cargando planes... **</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Datos médicos -->
                    <div class="header-section mt-5">DATOS MÉDICOS</div>
                    <div class="field">
                        <label class="label required">Alérgico al medicamento</label>
                        <div class="control">
                            <label class="radio">
                                <input type="radio" name="alergicoMedicamento" value="Si">
                                Sí
                            </label>
                            <label class="radio">
                                <input type="radio" name="alergicoMedicamento" value="No" checked>
                                No
                            </label>
                        </div>
                    </div>

                    <div class="columns">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Enfermedad Actual</label>
                                <div class="control">
                                    <input class="input" type="text" name="enfermedadActual"
                                        placeholder="Enfermedad Actual">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Medicamento Consumo</label>
                                <div class="control">
                                    <input class="input" type="text" name="medicamentoConsumo"
                                        placeholder="Medicamento Consumo">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label required">Realiza Educación Física</label>
                        <div class="control">
                            <label class="radio">
                                <input type="radio" name="realizaEducacionFisica" value="Si" checked>
                                Sí
                            </label>
                            <label class="radio">
                                <input type="radio" name="realizaEducacionFisica" value="No">
                                No
                            </label>
                        </div>
                    </div>

                    <!-- Documentos Entregados -->
                    <div class="header-section mt-5">DOCUMENTOS ENTREGADOS</div>

                    <div class="field">
                        <label class="label required">Certificado de Nacimiento</label>
                        <div class="control">
                            <label class="radio">
                                <input type="radio" name="certificadoNacimiento" value="Si">
                                Sí
                            </label>
                            <label class="radio">
                                <input type="radio" name="certificadoNacimiento" value="No" checked>
                                No
                            </label>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label required">Informe de personalidad</label>
                        <div class="control">
                            <label class="radio">
                                <input type="radio" name="informePersonalidad" value="Si">
                                Sí
                            </label>
                            <label class="radio">
                                <input type="radio" name="informePersonalidad" value="No" checked>
                                No
                            </label>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label required">Informe parcial de notas</label>
                        <div class="control">
                            <label class="radio">
                                <input type="radio" name="informeNotas" value="Si">
                                Sí
                            </label>
                            <label class="radio">
                                <input type="radio" name="informeNotas" value="No" checked>
                                No
                            </label>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label required">Certificado anual de estudios</label>
                        <div class="control">
                            <label class="radio">
                                <input type="radio" name="certificadoEstudios" value="Si">
                                Sí
                            </label>
                            <label class="radio">
                                <input type="radio" name="certificadoEstudios" value="No" checked>
                                No
                            </label>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label required">Ficha firmada por Apoderado</label>
                        <div class="control">
                            <label class="radio">
                                <input type="radio" name="fichaFirmada" value="Si">
                                Sí
                            </label>
                            <label class="radio">
                                <input type="radio" name="fichaFirmada" value="No" checked>
                                No
                            </label>
                        </div>
                    </div>

                    <!-- Recomendación -->
                    <div class="header-section mt-5">RECOMENDACIÓN</div>
                    <div class="field">
                        <label class="label">Por qué se decidió postular a su alumno</label>
                        <div class="control">
                            <div class="select is-fullwidth">
                                <select name="motivoPostulacion">
                                    <option value="">*** SELECCIONE UNA OPCIÓN ***</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label">Alumno que recomendó el establecimiento</label>
                        <div class="control">
                            <input class="input" type="text" name="alumnoRecomendo">
                        </div>
                    </div>

                    <!-- Observaciones -->
                    <div class="header-section mt-5">OBSERVACIONES</div>
                    <div class="columns">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Observaciones</label>
                                <div class="control">
                                    <input class="input" type="text" name="observaciones">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="columns">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">¿Qué quiere ser cuando grande y por qué?</label>
                                <div class="control">
                                    <textarea class="textarea" name="aspiracionFutura"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">¿A quién admira?</label>
                                <div class="control">
                                    <textarea class="textarea" name="personaAdmirada"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Datos Familiares -->
            <div id="datos-familiares" class="tab-content">
                <div class="header-section">Datos Familiares</div>
                <form id="form-datos-familiares">
                    <div class="columns is-multiline">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Vive Con</label>
                                <div class="control">
                                    <div class="select is-fullwidth">
                                        <select name="viveCon">
                                            <option value="Ambos Padres">Ambos Padres</option>
                                            <option value="Madre">Madre</option>
                                            <option value="Padre">Padre</option>
                                            <option value="Otro Familiar">Otro Familiar</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Tipo de Vivienda</label>
                                <div class="control">
                                    <div class="select is-fullwidth">
                                        <select name="tipoVivienda">
                                            <option value="PROPIA PAGADA">PROPIA PAGADA</option>
                                            <option value="PROPIA PAGANDO">PROPIA PAGANDO</option>
                                            <option value="ARRENDADA">ARRENDADA</option>
                                            <option value="ALLEGADO">ALLEGADO</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="columns is-multiline">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Nº Hermanos</label>
                                <div class="control">
                                    <input class="input" type="number" name="hermanos" id="numeroHermanos" value=""
                                        min="0" max="10">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Hermanos estudiando actualmente</label>
                                <div class="control">
                                    <input class="input" type="number" name="hermanosEstudiando" value="" min="0"
                                        max="10">
                                </div>
                            </div>
                        </div>

                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Año de nacimiento:</label>
                            </div>
                            <div id="contenedor-hermanos">
                                <!-- Los campos de hermanos se generarán dinámicamente cuando se ingrese el número -->
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">&nbsp;</label>
                            </div>
                            <div id="contenedor-hermanos-2">
                                <!-- Los campos de hermanos se generarán dinámicamente cuando se ingrese el número -->
                            </div>
                        </div>
                    </div>

                    <div class="columns is-multiline">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Nº Personas</label>
                                <div class="control">
                                    <input class="input" type="number" name="personas" value="" min="1">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Nº Trabajadores</label>
                                <div class="control">
                                    <input class="input" type="number" name="trabajadores" value="" min="0">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Ingreso Pesos (Líquido)</label>
                                <div class="control">
                                    <input class="input" type="number" name="ingresoPesos" value="" min="0">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="columns">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Teléfono</label>
                                <div class="control">
                                    <input class="input" type="text" name="telefonoFamiliar" value="">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Nombre del Contacto</label>
                                <div class="control">
                                    <input class="input" type="text" name="nombreContactoFamiliar" value="">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Datos familiar 1 -->
                    <div class="header-section mt-5">DATOS FAMILIAR 1</div>
                    <div class="columns">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Parentesco</label>
                                <div class="control">
                                    <div class="select is-fullwidth">
                                        <select name="parentesco" id="parentesco">
                                            <option value="">** Seleccione **</option>
                                            <option value="Padre">Padre</option>
                                            <option value="Madre">Madre</option>
                                            <option value="Hermano/a">Hermano/a</option>
                                            <option value="Abuelo/a">Abuelo/a</option>
                                            <option value="Tío/a">Tío/a</option>
                                            <option value="Otro">Otro</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <div class="control">
                                    <button type="button" class="button is-info" id="btnCopiarComoApoderado">
                                        Copiar como Apoderado
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="columns is-multiline">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">RUT</label>
                                <div class="control">
                                    <input class="input" type="text" name="rutFamiliar" id="rutFamiliar"
                                        placeholder="Ej: 12.345.678-9">
                                    <label class="checkbox ml-2">
                                        <input type="checkbox" name="extranjeroSinRut" id="extranjeroSinRut">
                                        Extranjero sin Rut
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Apoderado Suplente</label>
                                <div class="control">
                                    <input type="checkbox" name="apoderadoSuplente">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Nombres</label>
                                <div class="control">
                                    <input class="input" type="text" name="nombresFamiliar" id="nombresFamiliar">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Apellido Paterno</label>
                                <div class="control">
                                    <input class="input" type="text" name="apellidoPaternoFamiliar"
                                        id="apellidoPaternoFamiliar">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Fecha Nacimiento</label>
                                <div class="control">
                                    <input class="input" type="date" name="fechaNacimientoFamiliar"
                                        id="fechaNacimientoFamiliar">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Apellido Materno</label>
                                <div class="control">
                                    <input class="input" type="text" name="apellidoMaternoFamiliar"
                                        id="apellidoMaternoFamiliar">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Nombre Empresa</label>
                                <div class="control">
                                    <input class="input" type="text" name="nombreEmpresa" id="nombreEmpresa">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Género</label>
                                <div class="control">
                                    <div class="select is-fullwidth">
                                        <select name="generoFamiliar" id="generoFamiliar">
                                            <option value="">** Seleccione **</option>
                                            <option value="Masculino">Masculino</option>
                                            <option value="Femenino">Femenino</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Dirección del Trabajo</label>
                                <div class="control">
                                    <input class="input" type="text" name="direccionTrabajo" id="direccionTrabajo">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Cargo en la Empresa</label>
                                <div class="control">
                                    <input class="input" type="text" name="cargoEmpresa" id="cargoEmpresa">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="columns">
                        <div class="column">
                            <div class="field">
                                <label class="label">Teléfono</label>
                                <div class="control">
                                    <input class="input" type="text" name="telefonoFamiliar2" id="telefonoFamiliar2">
                                </div>
                            </div>
                        </div>
                        <div class="column">
                            <div class="field">
                                <label class="label">Teléfono del Trabajo</label>
                                <div class="control">
                                    <input class="input" type="text" name="telefonoTrabajo" id="telefonoTrabajo">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="familiares-adicionales"></div>

                    <div class="field">
                        <div class="control">
                            <button type="button" class="button is-success" id="btnAgregarFamiliar">Agregar
                                Familiar</button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Datos Apoderado -->
            <div id="datos-apoderado" class="tab-content">
                <div class="header-section">Datos Apoderado</div>
                <form id="form-datos-apoderado">
                    <div class="field yellow-bg p-3">
                        <label class="label required">El Apoderado es</label>
                        <div class="control">
                            <div class="select">
                                <select name="tipoApoderado" id="tipoApoderado">
                                    <option value="">** Seleccione **</option>
                                    <option value="Madre">Madre</option>
                                    <option value="Padre">Padre</option>
                                    <option value="Abuelo/a">Abuelo/a</option>
                                    <option value="Tío/a">Tío/a</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                            <span class="ml-2">(*) Según la selección se autocompletará con la información de
                                "Familiares"</span>
                        </div>
                    </div>

                    <div class="columns is-multiline">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Apellido Paterno</label>
                                <div class="control">
                                    <input class="input" type="text" name="apellidoPaternoApoderado" value="ORMAZABAL">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Apellido Materno</label>
                                <div class="control">
                                    <input class="input" type="text" name="apellidoMaternoApoderado" value="RODRIGUEZ">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Nombres</label>
                                <div class="control">
                                    <input class="input" type="text" name="nombresApoderado"
                                        value="VERONICA DEL CARMEN">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Cédula de identidad</label>
                                <div class="control">
                                    <input class="input" type="text" name="rutApoderado" value="1.230.546-0">
                                    <label class="checkbox ml-2">
                                        <input type="checkbox" name="extranjeroSinRutApoderado" checked>
                                        Extranjero sin Rut
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Género</label>
                                <div class="control">
                                    <label class="radio">
                                        <input type="radio" name="generoApoderado" value="1">
                                        Masculino
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="generoApoderado" value="2" checked>
                                        Femenino
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Fecha. Nacimiento</label>
                                <div class="control">
                                    <input class="input" type="date" name="fechaNacimientoApoderado" value="1968-02-16">
                                    <span id="edadApoderado">57.1 años.</span>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Dirección: Calle/Pasaje/Avenida</label>
                                <div class="control">
                                    <input class="input" type="text" name="direccionApoderado" value="EL AZADON">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Dirección: Número</label>
                                <div class="control">
                                    <input class="input" type="text" name="numeroApoderado" value="2182">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Dirección: Villa/Población</label>
                                <div class="control">
                                    <input class="input" type="text" name="villaApoderado">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label required">Comuna</label>
                                <div class="control">
                                    <div class="select is-fullwidth">
                                        <select name="idComunaApoderado">
                                            <option value="">** Cargando comunas... **</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Teléfono</label>
                                <div class="control">
                                    <input class="input" type="text" name="telefonoApoderado" value="978467607">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">E-Mail</label>
                                <div class="control">
                                    <input class="input" type="email" name="emailApoderado">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Nombre del Contacto</label>
                                <div class="control">
                                    <input class="input" type="text" name="nombreContactoApoderado">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="columns">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Email 1:</label>
                                <div class="control">
                                    <input class="input" type="email" name="email1">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="columns">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Email 2:</label>
                                <div class="control">
                                    <input class="input" type="email" name="email2">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="columns">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Email 3:</label>
                                <div class="control">
                                    <input class="input" type="email" name="email3">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="columns is-multiline">
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Empresa</label>
                                <div class="control">
                                    <input class="input" type="text" name="empresaApoderado">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Cargo</label>
                                <div class="control">
                                    <input class="input" type="text" name="cargoApoderado" value="DUEÑA DE CASA">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Años de antigüedad</label>
                                <div class="control">
                                    <input class="input" type="number" name="antiguedadApoderado" value="0" min="0">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Sueldo mensual pesos (Líquido)</label>
                                <div class="control">
                                    <input class="input" type="number" name="sueldoApoderado" value="0" min="0">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Dirección del trabajo</label>
                                <div class="control">
                                    <input class="input" type="text" name="direccionTrabajoApoderado">
                                </div>
                            </div>
                        </div>
                        <div class="column is-half">
                            <div class="field">
                                <label class="label">Teléfono trabajo/Celular</label>
                                <div class="control">
                                    <input class="input" type="text" name="telefonoTrabajoApoderado">
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Botón para guardar -->
            <div class="field mt-5">
                <div class="control">
                    <button class="button is-primary" id="guardar">Guardar Todo</button>
                </div>
            </div>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Manejo de pestañas
            const tabs = document.querySelectorAll(".tabs ul li");
            const tabContents = document.querySelectorAll(".tab-content");

            tabs.forEach(tab => {
                tab.addEventListener("click", () => {
                    // Solo cambiar de pestaña sin validación adicional
                    tabs.forEach(t => t.classList.remove("is-active"));
                    tabContents.forEach(tc => tc.classList.remove("is-active"));
                    tab.classList.add("is-active");
                    const target = tab.getAttribute("data-tab");
                    document.getElementById(target).classList.add("is-active");
                });
            });

            // Función para formatear el RUT con puntos y guión
            function rutFormateado(rut) {
                if (!rut) return '';

                // Si ya está en formato "SIN RUT", dejarlo así
                if (rut.toUpperCase() === 'SIN RUT') return rut;

                // Eliminar puntos y guion si ya existen
                rut = rut.toString().replace(/\./g, '').replace(/-/g, '');

                // Obtener el cuerpo y dígito verificador
                const cuerpo = rut.slice(0, -1) || '';
                const dv = rut.slice(-1).toUpperCase();

                // Formatear el cuerpo con puntos
                let resultado = '';
                let i = cuerpo.length;
                let contador = 0;

                while (i > 0) {
                    resultado = cuerpo.charAt(i - 1) + resultado;
                    contador++;
                    if (contador === 3 && i > 1) {
                        resultado = '.' + resultado;
                        contador = 0;
                    }
                    i--;
                }

                // Devolver el RUT formateado
                return resultado + '-' + dv;
            }

            // Función para validar RUT chileno
            function validaRut(rut) {
                // Verificar si el campo está vacío o es "SIN RUT"
                if (!rut || rut.toUpperCase() === 'SIN RUT') {
                    return true;
                }

                // Eliminar puntos y guión
                rut = rut.toString().replace(/\./g, '').replace(/-/g, '');

                // Verificar longitud mínima
                if (rut.length < 2) return false;

                // Separar cuerpo y dígito verificador
                const cuerpo = rut.slice(0, -1);
                const dv = rut.slice(-1).toUpperCase();

                // Calcular dígito verificador esperado
                let suma = 0;
                let multiplicador = 2;

                // Calcular suma ponderada
                for (let i = cuerpo.length - 1; i >= 0; i--) {
                    suma += parseInt(cuerpo.charAt(i)) * multiplicador;
                    multiplicador = multiplicador === 7 ? 2 : multiplicador + 1;
                }

                // Calcular dígito verificador
                let dvEsperado = 11 - (suma % 11);

                // Convertir a formato esperado
                if (dvEsperado === 11) dvEsperado = '0';
                else if (dvEsperado === 10) dvEsperado = 'K';
                else dvEsperado = dvEsperado.toString();

                // Verificar si el dígito verificador coincide
                return dv === dvEsperado;
            }

            // Función simplificada para verificar RUT
            function isRut(x) {
                // Si el campo está vacío, se considera válido
                if (x === "") return true;

                // Aceptar "SIN RUT" como válido
                if (x && x.toUpperCase() === 'SIN RUT') return true;

                // Eliminar puntos y guión
                x = x.toString().replace(/\./g, '').replace(/-/g, '');

                // Verificar longitud mínima
                if (x.length < 2) return false;

                // Separar cuerpo y dígito verificador
                const cuerpo = x.slice(0, -1);
                const dv = x.slice(-1).toUpperCase();

                // Calcular dígito verificador esperado
                let suma = 0;
                let multiplicador = 2;

                // Calcular suma ponderada
                for (let i = cuerpo.length - 1; i >= 0; i--) {
                    suma += parseInt(cuerpo.charAt(i)) * multiplicador;
                    multiplicador = multiplicador === 7 ? 2 : multiplicador + 1;
                }

                // Calcular dígito verificador
                let dvEsperado = 11 - (suma % 11);

                // Convertir a formato esperado
                if (dvEsperado === 11) dvEsperado = '0';
                else if (dvEsperado === 10) dvEsperado = 'K';
                else dvEsperado = dvEsperado.toString();

                // Verificar si el dígito verificador coincide
                return dv === dvEsperado;
            }

            // Reemplaza todos los caracteres del string
            function reemplazaString(texto, busca, reemplaza) {
                while (texto.indexOf(busca) != -1) {
                    texto = texto.replace(busca, reemplaza);
                }
                return texto;
            }

            // Función principal para validar RUT
            function validaRut(rut) {
                // Para adaptarlo a tu formulario, no usamos document.form1
                const formDatosPersonales = document.getElementById("form-datos-personales");
                const rutInput = formDatosPersonales.querySelector('input[name="rut"]');
                const sinRutCheckbox = formDatosPersonales.querySelector('input[name="sinRut"]');

                // Formatear el RUT ingresado
                rutInput.value = rutFormateado(rut);

                // Si no está marcado "Sin RUT", validar el RUT
                if (!sinRutCheckbox.checked) {
                    if (!isRut(rutInput.value)) {
                        alert("RUT inválido");
                        rutInput.focus();
                        rutInput.select();
                        rutInput.value = "";
                        return false;
                    }
                }

                return true;
            }



            // Funciones para mostrar mensajes y manejar botones
            function mostrarMensaje(mensaje, tipo = 'info') {
                if (tipo === 'success') {
                    alert('✅ ' + mensaje);
                } else if (tipo === 'error') {
                    alert('❌ ' + mensaje);
                } else {
                    alert('ℹ️ ' + mensaje);
                }
            }

            function deshabilitarBoton(btn, texto = 'Procesando...') {
                btn.disabled = true;
                btn.classList.add("is-loading");
                btn.setAttribute('data-original-text', btn.textContent);
                btn.textContent = texto;
            }

            function habilitarBoton(btn) {
                btn.disabled = false;
                btn.classList.remove("is-loading");
                if (btn.getAttribute('data-original-text')) {
                    btn.textContent = btn.getAttribute('data-original-text');
                }
            }

            // Cargar establecimientos anteriores
            fetch('/obtener-establecimientos')
                .then(response => response.json())
                .then(establecimientos => {
                    const selectEstablecimiento = document.getElementById('idEstablecimientoAnterior');
                    if (selectEstablecimiento) {
                        selectEstablecimiento.innerHTML = '<option value="">Seleccione establecimiento</option>';
                        selectEstablecimiento.innerHTML += '<option value="-1">SIN INFORMACIÓN</option>';

                        establecimientos.forEach(est => {
                            const option = document.createElement('option');
                            option.value = est.id_establecimiento;
                            option.textContent = `${est.nombre} ${est.rbd ? `(RBD: ${est.rbd})` : ''}`;
                            selectEstablecimiento.appendChild(option);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error al cargar establecimientos:', error);
                    const selectEstablecimiento = document.getElementById('idEstablecimientoAnterior');
                    if (selectEstablecimiento) {
                        selectEstablecimiento.innerHTML = '<option value="">Error al cargar establecimientos</option>';
                    }
                });


            // Función para actualizar la edad del apoderado basado en la fecha de nacimiento
            function actualizarEdadApoderado(fechaNacimiento) {
                if (!fechaNacimiento) return;

                const fechaNac = new Date(fechaNacimiento);
                const hoy = new Date();
                let edad = hoy.getFullYear() - fechaNac.getFullYear();
                const m = hoy.getMonth() - fechaNac.getMonth();

                if (m < 0 || (m === 0 && hoy.getDate() < fechaNac.getDate())) {
                    edad--;
                }

                // Calcular la parte decimal (meses como fracción de año)
                const mesesComoFraccion = (12 + hoy.getMonth() - fechaNac.getMonth()) % 12 / 12;
                const edadConDecimal = (m < 0 || (m === 0 && hoy.getDate() < fechaNac.getDate()))
                    ? edad + mesesComoFraccion
                    : edad + (hoy.getMonth() - fechaNac.getMonth()) / 12;

                document.getElementById('edadApoderado').textContent = `${edadConDecimal.toFixed(1)} años.`;
            }

            // Conectar selector de región y comuna
            fetch('/obtener-comunas')
                .then(response => response.json())
                .then(comunas => {
                    const comunaSelect = document.querySelector('select[name="idComuna"]');
                    const comunaApoderadoSelect = document.querySelector('select[name="idComunaApoderado"]');

                    if (comunaSelect) {
                        comunaSelect.innerHTML = '<option value="">Seleccione comuna</option>';
                        let regionesUnicas = [...new Set(comunas.map(c => c.region))].sort();

                        regionesUnicas.forEach(region => {
                            const comunasRegion = comunas.filter(c => c.region === region);
                            const optgroup = document.createElement('optgroup');
                            optgroup.label = region;

                            comunasRegion.forEach(comuna => {
                                const option = document.createElement('option');
                                option.value = comuna.id_comuna;
                                option.textContent = comuna.comuna;
                                optgroup.appendChild(option);
                            });

                            comunaSelect.appendChild(optgroup);
                        });
                    }

                    // También llenar el select de comunas del apoderado
                    if (comunaApoderadoSelect) {
                        comunaApoderadoSelect.innerHTML = comunaSelect ? comunaSelect.innerHTML : '<option value="">Seleccione comuna</option>';
                    }
                })
                .catch(error => {
                    console.error('Error al cargar comunas:', error);
                    const comunaSelect = document.querySelector('select[name="idComunaApoderado"]');
                    if (comunaSelect) {
                        comunaSelect.innerHTML = '<option value="">Error al cargar</option>';
                    }
                });
            // Cargar nacionalidades (añadir después del código de comunas)
            fetch('/obtener-nacionalidades')
                .then(response => response.json())
                .then(nacionalidades => { 
                    const nacionalidadSelect = document.querySelector('select[name="idNacionalidad"]');
                    if (nacionalidadSelect) {
                        nacionalidadSelect.innerHTML = '<option value="">Seleccione nacionalidad</option>';

                        // Ordenar nacionalidades alfabéticamente
                        //nacionalidades.sort((a, b) => a.nacionalidad.localeCompare(b.nacionalidad));

                        // Poner Chile primero si existe
                        const chileIndex = nacionalidades.findIndex(n => n.nacionalidad === 'Chilena');
                        if (chileIndex !== -1) {
                            const chile = nacionalidades.splice(chileIndex, 1)[0];
                            nacionalidades.unshift(chile);
                        }

                        nacionalidades.forEach(nac => {
                            const option = document.createElement('option');
                            option.value = nac.id_nacionalidad;
                            option.textContent = nac.nacionalidad;
                            nacionalidadSelect.appendChild(option);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error al cargar nacionalidades:', error);
                    // Si hay error, usar valores estáticos
                    const nacionalidadSelect = document.querySelector('select[name="nacionalidad"]');
                    if (nacionalidadSelect) {
                        nacionalidadSelect.innerHTML = `
                <option value="">Seleccione nacionalidad</option>
                <option value="1" selected>Chilena</option>
                <option value="2">Argentina</option>
                <option value="3">Peruana</option>
                <option value="4">Boliviana</option>
                <option value="5">Colombiana</option>
                <option value="6">Venezolana</option>
                <option value="7">Haitiana</option>
                <option value="8">Ecuatoriana</option>
                <option value="9">Brasileña</option>
                <option value="10">Otra</option>
            `;
                    }
                });

            // Cargar motivos de postulación (añadir después del código de nacionalidades)
            fetch('/obtener-motivos-postulacion')
                .then(response => response.json())
                .then(motivos => {
                    const motivoSelect = document.querySelector('select[name="motivoPostulacion"]');
                    if (motivoSelect) {
                        motivoSelect.innerHTML = '<option value="">*** SELECCIONE UNA OPCIÓN ***</option>';

                        motivos.forEach(motivo => {
                            const option = document.createElement('option');
                            option.value = motivo.id_motivo;
                            option.textContent = motivo.descripcion;
                            motivoSelect.appendChild(option);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error al cargar motivos de postulación:', error);
                    // Si hay error, usar valores estáticos
                    const motivoSelect = document.querySelector('select[name="motivoPostulacion"]');
                    if (motivoSelect) {
                        motivoSelect.innerHTML = `
                <option value="">*** SELECCIONE UNA OPCIÓN ***</option>
                <option value="1">Cerca del domicilio</option>
                <option value="2">Recomendación de conocidos</option>
                <option value="3">Prestigio académico</option>
                <option value="4">Instalaciones y equipamiento</option>
                <option value="5">Valores y formación</option>
                <option value="6">Otro</option>
            `;
                    }
                });

            // Cargar planes académicos
            fetch('/obtener-planes')
                .then(response => response.json())
                .then(planes => {
                    const planSelect = document.querySelector('select[name="plan"]');
                    if (planSelect) {
                        planSelect.innerHTML = '<option value="">Seleccione un plan</option>';

                        planes.forEach(plan => {
                            const option = document.createElement('option');
                            option.value = plan.id_plan;
                            option.textContent = plan.descripcion;
                            planSelect.appendChild(option);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error al cargar planes académicos:', error);
                    // Si hay error, usar valores estáticos
                    const planSelect = document.querySelector('select[name="plan"]');
                    if (planSelect) {
                        planSelect.innerHTML = `
                <option value="">Seleccione un plan</option>
                <option value="1">Plan Común</option>
                <option value="2">Plan Científico-Humanista</option>
                <option value="3">Plan Técnico-Profesional</option>
            `;
                    }
                });

            // Manejar campos dinámicos para hermanos según el número ingresado
            document.getElementById('numeroHermanos').addEventListener('change', function () {
                const numeroHermanos = parseInt(this.value) || 0;

                // Contenedor para los primeros hermanos (columna izquierda)
                const contenedorHermanos1 = document.getElementById('contenedor-hermanos');
                // Contenedor para el resto de hermanos (columna derecha)
                const contenedorHermanos2 = document.getElementById('contenedor-hermanos-2');

                // Limpiar contenedores
                contenedorHermanos1.innerHTML = '';
                contenedorHermanos2.innerHTML = '';

                // Crear campos para cada hermano
                for (let i = 1; i <= numeroHermanos; i++) {
                    const fieldHTML = `
        <div class="field">
            <label class="label">Hermano Nro ${i}</label>
            <div class="control">
                <input class="input" type="number" name="añoHermano${i}" value="${2023 - 20 - i}" min="1950" max="2025">
            </div>
        </div>
    `;

                    // Distribuir entre ambas columnas
                    if (i <= Math.ceil(numeroHermanos / 2)) {
                        contenedorHermanos1.innerHTML += fieldHTML;
                    } else {
                        contenedorHermanos2.innerHTML += fieldHTML;
                    }
                }
            });

            // Manejar checkbox "Sin Rut" para familiar
            document.getElementById('extranjeroSinRut').addEventListener('change', function () {
                const campoRut = document.getElementById('rutFamiliar');
                if (this.checked) {
                    campoRut.value = 'SIN RUT';
                    campoRut.disabled = true;
                } else {
                    campoRut.value = '';
                    campoRut.disabled = false;
                }
            });



            // Manejar el checkbox "Sin información" para establecimiento anterior
            document.getElementById('checkSinInformacion').addEventListener('change', function () {
                const establecimientoSelect = document.getElementById('idEstablecimientoAnterior');
                if (this.checked) {
                    establecimientoSelect.value = "-1"; // Opción "SIN INFORMACIÓN"
                    establecimientoSelect.disabled = true;
                } else {
                    establecimientoSelect.value = "";
                    establecimientoSelect.disabled = false;
                }
            });





            // Funcionalidad para el botón "Copiar como Apoderado"
            document.getElementById('btnCopiarComoApoderado').addEventListener('click', function (e) {
                e.preventDefault();

                // Verificar que los campos requeridos del familiar estén completos
                const nombresFamiliar = document.getElementById('nombresFamiliar').value;
                const apellidoPaternoFamiliar = document.getElementById('apellidoPaternoFamiliar').value;
                const apellidoMaternoFamiliar = document.getElementById('apellidoMaternoFamiliar').value;
                const rutFamiliar = document.getElementById('rutFamiliar').value;

                if (!nombresFamiliar || !apellidoPaternoFamiliar || !apellidoMaternoFamiliar) {
                    mostrarMensaje("Por favor complete los nombres y apellidos del familiar antes de copiar", "error");
                    return;
                }

                // Copiar datos al apoderado
                document.querySelector('select[name="tipoApoderado"]').value = document.getElementById('parentesco').value;
                document.querySelector('input[name="nombresApoderado"]').value = nombresFamiliar;
                document.querySelector('input[name="apellidoPaternoApoderado"]').value = apellidoPaternoFamiliar;
                document.querySelector('input[name="apellidoMaternoApoderado"]').value = apellidoMaternoFamiliar;
                document.querySelector('input[name="rutApoderado"]').value = rutFamiliar;

                // Manejar el checkbox de extranjero sin RUT
                const esExtranjero = document.getElementById('extranjeroSinRut').checked;
                document.querySelector('input[name="extranjeroSinRutApoderado"]').checked = esExtranjero;

                // Copiar género si está seleccionado
                const generoFamiliar = document.getElementById('generoFamiliar').value;
                if (generoFamiliar) {
                    const radioGenero = document.querySelector(`input[name="generoApoderado"][value="${generoFamiliar}"]`);
                    if (radioGenero) radioGenero.checked = true;
                }

                // Copiar fecha de nacimiento si está disponible
                const fechaNacimiento = document.getElementById('fechaNacimientoFamiliar').value;
                if (fechaNacimiento) {
                    document.querySelector('input[name="fechaNacimientoApoderado"]').value = fechaNacimiento;
                    actualizarEdadApoderado(fechaNacimiento);
                }

                // Copiar datos de trabajo
                document.querySelector('input[name="empresaApoderado"]').value = document.getElementById('nombreEmpresa').value || '';
                document.querySelector('input[name="cargoApoderado"]').value = document.getElementById('cargoEmpresa').value || '';
                document.querySelector('input[name="direccionTrabajoApoderado"]').value = document.getElementById('direccionTrabajo').value || '';
                document.querySelector('input[name="telefonoTrabajoApoderado"]').value = document.getElementById('telefonoTrabajo').value || '';

                // Copiar teléfono
                document.querySelector('input[name="telefonoApoderado"]').value = document.getElementById('telefonoFamiliar2').value || '';

                // Cambiar a la pestaña de apoderado
                document.querySelector('[data-tab="datos-apoderado"]').click();

                mostrarMensaje("Datos copiados al apoderado correctamente", "success");
            });

            // Agregar evento para actualizar edad cuando cambia la fecha de nacimiento
            document.querySelector('input[name="fechaNacimientoApoderado"]').addEventListener('change', function () {
                actualizarEdadApoderado(this.value);
            });

            // Funcionalidad para el botón "Agregar Familiar"
            document.getElementById('btnAgregarFamiliar').addEventListener('click', function (e) {
                e.preventDefault();

                // Verificar que los datos del familiar actual estén completos
                const campos = [
                    'parentesco', 'nombresFamiliar',
                    'apellidoPaternoFamiliar', 'apellidoMaternoFamiliar'
                ];

                let faltanCampos = false;
                campos.forEach(campo => {
                    const elemento = document.getElementById(campo);
                    if (!elemento.value) {
                        elemento.classList.add('is-danger');
                        faltanCampos = true;
                    } else {
                        elemento.classList.remove('is-danger');
                    }
                });

                if (faltanCampos) {
                    mostrarMensaje("Por favor complete todos los campos requeridos del familiar actual", "error");
                    return;
                }

                // Contador de familiares (empezamos con el 2 porque ya tenemos el familiar 1)
                const contadorFamiliares = document.querySelectorAll('.datos-familiar').length + 2;

                // HTML para un nuevo familiar
                const nuevoFamiliarHTML = `
<div class="datos-familiar" id="familiar-${contadorFamiliares}">
    <div class="header-section mt-5">DATOS FAMILIAR ${contadorFamiliares}</div>
    <div class="columns">
        <div class="column is-half">
            <div class="field">
                <label class="label required">Parentesco</label>
                <div class="control">
                    <div class="select is-fullwidth">
                        <select name="parentesco_${contadorFamiliares}">
                            <option value="">** Seleccione **</option>
                            <option value="Padre">Padre</option>
                            <option value="Madre">Madre</option>
                            <option value="Hermano/a">Hermano/a</option>
                            <option value="Abuelo/a">Abuelo/a</option>
                            <option value="Tío/a">Tío/a</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="column is-half">
            <div class="field">
                <div class="control">
                    <button type="button" class="button is-danger is-light" onclick="eliminarFamiliar(${contadorFamiliares})">
                        Eliminar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="columns is-multiline">
        <div class="column is-half">
            <div class="field">
                <label class="label required">RUT</label>
                <div class="control">
                    <input class="input" type="text" name="rutFamiliar_${contadorFamiliares}" placeholder="Ej: 12.345.678-9">
                    <label class="checkbox ml-2">
                        <input type="checkbox" name="extranjeroSinRut_${contadorFamiliares}" onchange="marcarSinRut(this, ${contadorFamiliares})">
                        Extranjero sin Rut
                    </label>
                </div>
            </div>
        </div>
        <div class="column is-half">
            <div class="field">
                <label class="label">Apoderado Suplente</label>
                <div class="control">
                    <input type="checkbox" name="apoderadoSuplente_${contadorFamiliares}">
                </div>
            </div>
        </div>
        <div class="column is-half">
            <div class="field">
                <label class="label required">Nombres</label>
                <div class="control">
                    <input class="input" type="text" name="nombresFamiliar_${contadorFamiliares}">
                </div>
            </div>
        </div>
        <div class="column is-half">
            <div class="field">
                <label class="label required">Apellido Paterno</label>
                <div class="control">
                    <input class="input" type="text" name="apellidoPaternoFamiliar_${contadorFamiliares}">
                </div>
            </div>
        </div>
        <div class="column is-half">
            <div class="field">
                <label class="label">Apellido Materno</label>
                <div class="control">
                    <input class="input" type="text" name="apellidoMaternoFamiliar_${contadorFamiliares}">
                </div>
            </div>
        </div>
        <div class="column is-half">
            <div class="field">
                <label class="label">Fecha Nacimiento</label>
                <div class="control">
                    <input class="input" type="date" name="fechaNacimientoFamiliar_${contadorFamiliares}">
                </div>
            </div>
        </div>
    </div>
</div>
`;

                // Agregar el nuevo familiar al contenedor
                document.getElementById('familiares-adicionales').insertAdjacentHTML('beforeend', nuevoFamiliarHTML);

                mostrarMensaje(`Se ha agregado el familiar ${contadorFamiliares}`, "success");
            });

            // Función para marcar "Sin RUT" en familiares adicionales
            window.marcarSinRut = function (checkbox, id) {
                const rutInput = document.querySelector(`input[name="rutFamiliar_${id}"]`);
                if (checkbox.checked) {
                    rutInput.value = 'SIN RUT';
                    rutInput.disabled = true;
                } else {
                    rutInput.value = '';
                    rutInput.disabled = false;
                }
            };

            // Funcionalidad para autocompletar datos del apoderado basado en el familiar seleccionado
            document.getElementById('tipoApoderado').addEventListener('change', function () {
                const seleccion = this.value;

                // Buscar si existe un familiar con ese parentesco
                const parentescoSelects = document.querySelectorAll('[name^="parentesco"]');

                let familiarEncontrado = false;
                parentescoSelects.forEach(select => {
                    if (select.value === seleccion) {
                        familiarEncontrado = true;

                        // Determinar el sufijo del familiar (vacío para el primero, _2, _3, etc. para los siguientes)
                        const nombreInput = select.name;
                        const esPrimero = nombreInput === "parentesco";
                        const sufijo = esPrimero ? "" : nombreInput.substring(nombreInput.indexOf("_"));

                        // Copiar datos al apoderado
                        document.querySelector('input[name="nombresApoderado"]').value =
                            document.querySelector(`input[name="nombresFamiliar${sufijo}"]`).value || '';

                        document.querySelector('input[name="apellidoPaternoApoderado"]').value =
                            document.querySelector(`input[name="apellidoPaternoFamiliar${sufijo}"]`).value || '';

                        document.querySelector('input[name="apellidoMaternoApoderado"]').value =
                            document.querySelector(`input[name="apellidoMaternoFamiliar${sufijo}"]`).value || '';

                        document.querySelector('input[name="rutApoderado"]').value =
                            document.querySelector(`input[name="rutFamiliar${sufijo}"]`).value || '';

                        // Manejar el checkbox de extranjero sin RUT
                        const esExtranjero = document.querySelector(`input[name="extranjeroSinRut${sufijo}"]`)?.checked || false;
                        document.querySelector('input[name="extranjeroSinRutApoderado"]').checked = esExtranjero;

                        // Copiar fecha de nacimiento si está disponible
                        const fechaNacimiento = document.querySelector(`input[name="fechaNacimientoFamiliar${sufijo}"]`)?.value || '';
                        if (fechaNacimiento) {
                            document.querySelector('input[name="fechaNacimientoApoderado"]').value = fechaNacimiento;
                            actualizarEdadApoderado(fechaNacimiento);
                        }

                        mostrarMensaje(`Datos del familiar con parentesco ${seleccion} copiados al apoderado`, "success");
                    }
                });

                if (!familiarEncontrado) {
                    mostrarMensaje(`No se encontró ningún familiar con parentesco ${seleccion}`, "info");
                }
            });

            // Función para eliminar familiar (debe estar en el ámbito global)
            window.eliminarFamiliar = function (id) {
                const familiar = document.getElementById(`familiar-${id}`);
                if (familiar) {
                    if (confirm(`¿Está seguro de eliminar el familiar ${id}?`)) {
                        familiar.remove();
                        mostrarMensaje(`Familiar ${id} eliminado`, "info");
                    }
                }
            };

            // Manejo del botón "Guardar Todo"
            document.getElementById("guardar").addEventListener("click", async () => {
                // Obtener los formularios
                const formDatosPersonales = document.getElementById("form-datos-personales");
                const formDatosFamiliares = document.getElementById("form-datos-familiares");
                const formDatosApoderado = document.getElementById("form-datos-apoderado");

                // Validación básica
                if (!formDatosPersonales.checkValidity()) {
                    mostrarMensaje("Por favor complete todos los campos requeridos en Datos Personales", "error");
                    tabs.forEach(t => t.classList.remove("is-active"));
                    tabContents.forEach(tc => tc.classList.remove("is-active"));
                    tabs[0].classList.add("is-active");
                    document.getElementById("datos-personales").classList.add("is-active");
                    return;
                }

                // Validar RUT cuando corresponda
                const rut = formDatosPersonales.querySelector('[name="rut"]').value;
                const sinRut = formDatosPersonales.querySelector('[name="sinRut"]').checked;

                if (!sinRut && rut && rut.toUpperCase() !== 'SIN RUT' && !validaRut(rut)) {
                    mostrarMensaje("El RUT ingresado no es válido. Formato correcto: 12345678-9", "error");
                    formDatosPersonales.querySelector('[name="rut"]').focus();
                    document.querySelector('[data-tab="datos-personales"]').click();
                    return;
                }

                // Mostrar indicador de carga
                const btnGuardar = document.getElementById("guardar");
                deshabilitarBoton(btnGuardar, "Guardando...");

                try {
                    // Recopilar datos del formulario
                    const formData = new FormData(formDatosPersonales);
                    const formDataFamiliares = new FormData(formDatosFamiliares);
                    const formDataApoderado = new FormData(formDatosApoderado);

                    // Verificar que los campos numéricos solo tienen números
                    const telefonos = [
                        formData.get('telefono'),
                        formDataApoderado.get('telefonoApoderado'),
                        formDataApoderado.get('telefonoTrabajoApoderado'),
                        formDataFamiliares.get('telefonoFamiliar'),
                        formDataFamiliares.get('telefonoFamiliar2'),
                        formDataFamiliares.get('telefonoTrabajo')
                    ];

                    for (let tel of telefonos) {
                        if (tel && !/^[0-9]+$/.test(tel)) {
                            mostrarMensaje("Error: Los números de teléfono solo deben contener dígitos", "error");
                            return;
                        }
                    }

                    // Verificar que los campos de hermanos solo tienen números
                    const hermanos = formDataFamiliares.get('hermanos');
                    const hermanosEstudiando = formDataFamiliares.get('hermanosEstudiando');

                    if ((hermanos && !/^[0-9]+$/.test(hermanos)) ||
                        (hermanosEstudiando && !/^[0-9]+$/.test(hermanosEstudiando))) {
                        mostrarMensaje("Error: Los campos de hermanos solo deben contener números", "error");
                        return;
                    }

                    // Preparar datos para el usuario
                    var userData = {
                        rut: formData.get('rut') || (formData.get('sinRut') ? 'SIN RUT' : ''),
                        nombres: formData.get('nombres'),
                        apellidoPaterno: formData.get('apellidoPaterno'),
                        apellidoMaterno: formData.get('apellidoMaterno'),
                        telefono: formData.get('telefono'),
                        email: formData.get('email'),
                        direccion: formData.get('direccion'),
                        numeroCasa: formData.get('numero'),
                        villa: formData.get('villa'),
                        departamento: formData.get('departamento'),
                        comuna: formData.get('idComuna'),
                        genero: formData.get('genero'),
                        nacionalidad: formData.get('idNacionalidad')
                    };

                    // Paso 1: Crear el usuario
                    console.log("Creando usuario...", userData);
                    var userResponse = await fetch('/crear-usuario', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: new URLSearchParams(userData)
                    });


                    var userResult = await userResponse.json();
                    if (!userResult.success) {
                        throw new Error("Error al crear usuario: " + userResult.error);
                    }

                    var idUsuario = userResult.idUsuario;
                    console.log("Usuario creado con ID:", idUsuario);


                    // Paso 2: Crear el apoderado
                    // Preparar datos para el usuario apoderado
                    userData = {
                        rut: formData.get('rutApoderado') || (formData.get('sinRut') ? 'SIN RUT' : ''),
                        nombres: formData.get('nombresApoderado'),
                        apellidoPaterno: formData.get('apellidoPaternoApoderado'),
                        apellidoMaterno: formData.get('apellidoPaternoApoderado'),
                        telefono: formData.get('telefonoApoderado'),
                        email: formData.get('emailApoderado'),
                        direccion: formData.get('direccionApoderado'),
                        numeroCasa: formData.get('numeroApoderado'),
                        villa: formData.get('villaApoderado'),
                        departamento: formData.get('departamento'),
                        comuna: formData.get('idComunaApoderado'),
                        genero: parseInt (formData.get('generoApoderado')) || 0,

                    };

                    // Paso 1: Crear el usuario
                    console.log("Creando usuario...");
                    userResponse = await fetch('/crear-usuario', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: new URLSearchParams(userData)
                    });

                    userResult = await userResponse.json();
                    if (!userResult.success) {
                        throw new Error("Error al crear usuario: " + userResult.error);
                    }

                    idUsuario = userResult.idUsuario;
                    console.log("Usuario creado con ID:", idUsuario);

                    const apoderadoData = {
                        idUsuario: idUsuario,
                        empresa: formDataApoderado.get('empresaApoderado'),
                        cargo: formDataApoderado.get('cargoApoderado'),
                        sueldo: formDataApoderado.get('sueldoApoderado') || 0,
                        antiguedad: formDataApoderado.get('antiguedadApoderado') || 0,
                        direccionTrabajo: formDataApoderado.get('direccionTrabajoApoderado'),
                        telefonoTrabajo: formDataApoderado.get('telefonoTrabajoApoderado')
                    };

                    console.log("Creando apoderado...");
                    const apoderadoResponse = await fetch('/crear-apoderado', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: new URLSearchParams(apoderadoData)
                    });

                    const apoderadoResult = await apoderadoResponse.json();
                    if (!apoderadoResult.success) {
                        throw new Error("Error al crear apoderado: " + apoderadoResult.error);
                    }

                    // Paso 3: Crear el alumno
                    const alumnoData = {
                        idUsuario: idUsuario,
                        fechaNacimiento: formData.get('fechaNacimiento'),
                        anoAcademico: formData.get('anioIngreso') || new Date().getFullYear(), // Usar el valor seleccionado en el formulario
                        curso: "1", // Valor por defecto, ajustar según sea necesario
                        promedioAnterior: formData.get('promedioAnterior'),
                        programaPIE: formData.get('programaPIE') === 'Si' ? 'S' : 'N',
                        alergico: formData.get('alergicoMedicamento') === 'Si' ? 'S' : 'N',
                        enfermedadActual: formData.get('enfermedadActual'),
                        educacionFisica: formData.get('realizaEducacionFisica') === 'Si' ? 'S' : 'N',
                        idApoderado: idUsuario,
                        establecimientoAnterior: document.getElementById('idEstablecimientoAnterior')?.value || null
                    };

                    console.log("Creando alumno...");
                    const alumnoResponse = await fetch('/crear-alumno', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: new URLSearchParams(alumnoData)
                    });

                    const alumnoResult = await alumnoResponse.json();
                    if (!alumnoResult.success) {
                        throw new Error("Error al crear alumno: " + alumnoResult.error);
                    }

                    // Paso 4: Guardar datos completos y adicionales
                    const datosCompletos = {
                        idUsuario: idUsuario,
                        origenIndigena: formData.get('origenIndigena'),
                        programaPIE: formData.get('programaPIE'),
                        realizaEducacionFisica: formData.get('realizaEducacionFisica'),
                        alergicoMedicamento: formData.get('alergicoMedicamento'),
                        enfermedadActual: formData.get('enfermedadActual'),
                        medicamentoConsumo: formData.get('medicamentoConsumo'),
                        certificadoNacimiento: formData.get('certificadoNacimiento'),
                        informePersonalidad: formData.get('informePersonalidad'),
                        informeNotas: formData.get('informeNotas'),
                        certificadoEstudios: formData.get('certificadoEstudios'),
                        fichaFirmada: formData.get('fichaFirmada'),
                        observaciones: formData.get('observaciones'),
                        aspiracionFutura: formData.get('aspiracionFutura'),
                        personaAdmirada: formData.get('personaAdmirada'),

                        // Datos familiares
                       
                        viveCon: formDataFamiliares.get('viveCon'),
                        tipoVivienda: formDataFamiliares.get('tipoVivienda'),
                        hermanos: formDataFamiliares.get('hermanos'),
                        hermanosEstudiando: formDataFamiliares.get('hermanosEstudiando'),
                        personas: formDataFamiliares.get('personas'),
                        trabajadores: formDataFamiliares.get('trabajadores'),
                        ingresoPesos: formDataFamiliares.get('ingresoPesos'),
                        telefonoFamiliar: formDataFamiliares.get('telefonoFamiliar'),

                        // Datos del familiar
                        nombresFamiliar: formDataFamiliares.get('nombresFamiliar'),
                        apellidoPaternoFamiliar: formDataFamiliares.get('apellidoPaternoFamiliar'),
                        apellidoMaternoFamiliar: formDataFamiliares.get('apellidoMaternoFamiliar'),
                        rutFamiliar: formDataFamiliares.get('rutFamiliar'),
                        nombreEmpresa: formDataFamiliares.get('nombreEmpresa'),
                        cargoEmpresa: formDataFamiliares.get('cargoEmpresa'),
                        direccionTrabajo: formDataFamiliares.get('direccionTrabajo'),
                        telefonoTrabajo: formDataFamiliares.get('telefonoTrabajo'),
                        telefonoFamiliar2: formDataFamiliares.get('telefonoFamiliar2')
                    };

                    console.log("Guardando datos completos...");
                    const datosCompletosResponse = await fetch('/guardar-datos-completos', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(datosCompletos)
                    });

                    const datosCompletosResult = await datosCompletosResponse.json();
                    if (!datosCompletosResult.success) {
                        throw new Error("Error al guardar datos completos: " + datosCompletosResult.error);
                    }

                    // Paso 5: Guardar familiares adicionales
                    const familiares = document.querySelectorAll('.datos-familiar');
                    if (familiares.length > 0) {
                        console.log("Guardando familiares adicionales...");

                        // Para el familiar principal (siempre existe)
                        const familiarPrincipal = {
                            idUsuario: idUsuario,
                            parentesco: formDataFamiliares.get('parentesco'),
                            rut: formDataFamiliares.get('rutFamiliar'),
                            nombres: formDataFamiliares.get('nombresFamiliar'),
                            apellidoPaterno: formDataFamiliares.get('apellidoPaternoFamiliar'),
                            apellidoMaterno: formDataFamiliares.get('apellidoMaternoFamiliar'),
                            fechaNacimiento: formDataFamiliares.get('fechaNacimientoFamiliar'),
                            esApoderadoSuplente: formDataFamiliares.get('apoderadoSuplente') === 'on' ? 1 : 0,
                            sexo: formDataFamiliares.get('generoFamiliar'),
                            telefono: formDataFamiliares.get('telefonoFamiliar2'),
                            nombreEmpresa: formDataFamiliares.get('nombreEmpresa'),
                            cargoEmpresa: formDataFamiliares.get('cargoEmpresa'),
                            direccionTrabajo: formDataFamiliares.get('direccionTrabajo'),
                            telefonoTrabajo: formDataFamiliares.get('telefonoTrabajo')
                        };

                        const familiarResponse = await fetch('/guardar-familiar', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                            body: new URLSearchParams(familiarPrincipal)
                        });

                        // Guardar familiares adicionales
                        for (let i = 2; i <= familiares.length + 1; i++) {
                            try {
                                const sufijo = `_${i}`;
                                const familiar = {
                                    idUsuario: idUsuario,
                                    parentesco: document.querySelector(`select[name="parentesco${sufijo}"]`)?.value,
                                    rut: document.querySelector(`input[name="rutFamiliar${sufijo}"]`)?.value,
                                    nombres: document.querySelector(`input[name="nombresFamiliar${sufijo}"]`)?.value,
                                    apellidoPaterno: document.querySelector(`input[name="apellidoPaternoFamiliar${sufijo}"]`)?.value,
                                    apellidoMaterno: document.querySelector(`input[name="apellidoMaternoFamiliar${sufijo}"]`)?.value,
                                    fechaNacimiento: document.querySelector(`input[name="fechaNacimientoFamiliar${sufijo}"]`)?.value,
                                    esApoderadoSuplente: document.querySelector(`input[name="apoderadoSuplente${sufijo}"]`)?.checked ? 1 : 0
                                };

                                if (familiar.parentesco && familiar.nombres) {
                                    await fetch('/guardar-familiar', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                                        body: new URLSearchParams(familiar)
                                    });
                                    console.log(`Familiar ${i} guardado`);
                                }
                            } catch (error) {
                                console.error(`Error al guardar familiar ${i}:`, error);
                                // Continuamos con el siguiente familiar
                            }
                        }
                    }

                    // Todo se guardó correctamente
                    mostrarMensaje(`Registro completado con éxito. ID de usuario: ${idUsuario}`, "success");

                    // Redirigir a la página de listado
                    setTimeout(() => {
                        window.location.href = "/listar";
                    }, 3000);

                } catch (error) {
                    console.error("Error en el proceso de registro:", error);
                    mostrarMensaje("Error: " + error.message, "error");
                } finally {
                    // Quitar indicador de carga
                    habilitarBoton(btnGuardar);
                }
            });

            // Inicializar validaciones de formulario
            validarSoloNumeros();
            validarSoloTexto();
            validarCamposNumericos(); // Reemplaza validarNumeroHermanos() por esta nueva función
        });
    </script>
    <script>
        // Validaciones para campos de formulario
        function validarSoloNumeros() {
            // Obtener todos los campos de teléfono
            const camposTelefono = document.querySelectorAll('input[name="telefono"], input[name="telefonoApoderado"], input[name="telefonoTrabajoApoderado"], input[name="telefonoFamiliar"], input[name="telefonoFamiliar2"], input[name="telefonoTrabajo"]');

            camposTelefono.forEach(campo => {
                campo.addEventListener('input', function (e) {
                    // Remover cualquier caracter que no sea un número
                    this.value = this.value.replace(/[^0-9]/g, '');

                    // Limitar a 9 dígitos (opcional)
                    if (this.value.length > 9) {
                        this.value = this.value.slice(0, 9);
                    }
                });

                campo.addEventListener('keypress', function (e) {
                    const charCode = (e.which) ? e.which : e.keyCode;
                    if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                        e.preventDefault();
                        return false;
                    }
                });
            });
        }

        function validarSoloTexto() {
            // Obtener todos los campos de nombre
            const camposTexto = document.querySelectorAll('input[name="nombres"], input[name="apellidoPaterno"], input[name="apellidoMaterno"], input[name="nombresApoderado"], input[name="apellidoPaternoApoderado"], input[name="apellidoMaternoApoderado"], input[name="nombreContacto"], input[name="nombresFamiliar"], input[name="apellidoPaternoFamiliar"], input[name="apellidoMaternoFamiliar"], input[name="nombreContactoFamiliar"]');

            camposTexto.forEach(campo => {
                campo.addEventListener('input', function (e) {
                    // Remover números y caracteres especiales, permitir letras, espacios y acentos
                    this.value = this.value.replace(/[^a-zA-ZáéíóúÁÉÍÓÚñÑüÜ\s]/g, '');
                });

                campo.addEventListener('keypress', function (e) {
                    const charCode = (e.which) ? e.which : e.keyCode;
                    // Permitir letras, espacios y caracteres con tilde
                    const regex = /^[a-zA-ZáéíóúÁÉÍÓÚñÑüÜ\s]$/;
                    if (!regex.test(String.fromCharCode(charCode))) {
                        e.preventDefault();
                        return false;
                    }
                });
            });
        }

        function validarCamposNumericos() {
            // Seleccionar todos los campos numéricos que deben tener solo números
            const camposNumericos = document.querySelectorAll('input[name="hermanos"], input[name="hermanosEstudiando"], input[name="personas"], input[name="trabajadores"], input[name="ingresoPesos"], input[name="antiguedadApoderado"], input[name="sueldoApoderado"]');

            camposNumericos.forEach(campo => {
                // Cambiar type de "number" a "text" para mejor control
                campo.type = 'text';

                campo.addEventListener('input', function (e) {
                    // Remover cualquier caracter que no sea un número
                    this.value = this.value.replace(/[^0-9]/g, '');

                    // Específicamente prevenir la letra "e" que podría ingresar en campos number
                    this.value = this.value.replace(/e/gi, '');

                    // Limitar a números razonables según el campo
                    if (this.value !== '') {
                        const num = parseInt(this.value);

                        if (this.name === 'hermanos' || this.name === 'hermanosEstudiando') {
                            // Limitar a 99 para hermanos
                            if (num > 99) this.value = '99';
                        } else if (this.name === 'personas' || this.name === 'trabajadores') {
                            // Limitar a 99 para personas/trabajadores
                            if (num > 99) this.value = '99';
                        }
                        // Los campos de ingresos y sueldos no los limitamos para permitir valores mayores
                    }
                });

                campo.addEventListener('keypress', function (e) {
                    const charCode = (e.which) ? e.which : e.keyCode;
                    // Prevenir explícitamente la "e" (código 101 o 69) además de otros caracteres no numéricos
                    if (charCode === 101 || charCode === 69 || (charCode > 31 && (charCode < 48 || charCode > 57))) {
                        e.preventDefault();
                        return false;
                    }
                });

                // Prevenir pegar contenido no numérico
                campo.addEventListener('paste', function (e) {
                    let pasteData = (e.clipboardData || window.clipboardData).getData('text');
                    if (/[^0-9]/.test(pasteData)) {
                        e.preventDefault();
                        return false;
                    }
                });
            });
        }

        // Cargar años académicos
        function cargarAnosAcademicos() {
            fetch('/obtener-anos')
                .then(response => response.json())
                .then(anos => {
                    const selectAnio = document.getElementById('anioIngreso');

                    // Limpiar las opciones existentes
                    selectAnio.innerHTML = '';

                    if (anos.length === 0) {
                        selectAnio.innerHTML = '<option value="">No hay años disponibles</option>';
                        return;
                    }

                    // Agregar las opciones recibidas
                    anos.forEach(ano => {
                        const option = document.createElement('option');
                        option.value = ano.id_ano;
                        option.textContent = ano.nombre_ano;
                        selectAnio.appendChild(option);
                    });

                    // Seleccionar el año actual por defecto
                    const anioActual = new Date().getFullYear().toString();
                    let encontrado = false;
                    for (let i = 0; i < selectAnio.options.length; i++) {
                        if (selectAnio.options[i].textContent === anioActual) {
                            selectAnio.options[i].selected = true;
                            encontrado = true;
                            break;
                        }
                    }

                    // Si no se encontró el año actual, seleccionar la primera opción
                    if (!encontrado && selectAnio.options.length > 0) {
                        selectAnio.options[0].selected = true;
                    }
                })
                .catch(error => {
                    console.error('Error al cargar años académicos:', error);
                    document.getElementById('anioIngreso').innerHTML =
                        '<option value="1">Error al cargar, usando año predeterminado</option>';
                });
        }

        // Llama a la función para cargar los años académicos
        cargarAnosAcademicos();
    </script>
</body>

</html>